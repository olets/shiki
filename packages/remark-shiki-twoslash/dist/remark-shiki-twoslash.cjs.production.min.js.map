{"version":3,"file":"remark-shiki-twoslash.cjs.production.min.js","sources":["../src/caching.ts","../src/includes.ts","../src/exceptionMessageDOM.ts","../src/index.ts"],"sourcesContent":["import { UserConfigSettings, runTwoSlash } from \"@olets/shiki-twoslash\";\nimport type { TwoSlashReturn } from \"@typescript/twoslash\";\n\n/**\n * Keeps a cache of the JSON responses to a twoslash call in node_modules/.cache/twoslash\n * which should keep CI times down (e.g. the epub vs the handbook etc) - but also during\n * dev time, where it can be super useful.\n */\nexport async function cachedTwoslashCall(\n  code: string,\n  lang: string,\n  settings: UserConfigSettings\n): Promise<TwoSlashReturn | undefined> {\n  const isWebWorker =\n    typeof self !== \"undefined\" &&\n    // @ts-expect-error\n    typeof self.WorkerGlobalScope !== \"undefined\";\n  const isBrowser =\n    isWebWorker ||\n    (typeof window !== \"undefined\" &&\n      typeof window.document !== \"undefined\" &&\n      typeof fetch !== \"undefined\");\n\n  if (isBrowser) {\n    // Not in Node, run un-cached\n    return runTwoSlash(code, lang, settings);\n  }\n\n  const { createHash } = await import(\"crypto\");\n  const { readFileSync, existsSync, mkdirSync, writeFileSync } = await import(\n    \"fs\"\n  );\n  const { join } = await import(\"path\");\n\n  const shikiVersion = await import(\"@typescript/twoslash/package.json\").then(\n    (m) => m.version\n  );\n  const tsVersion = await import(\"typescript/package.json\").then(\n    (m) => m.version\n  );\n  const shasum = createHash(\"sha1\");\n  const codeSha = shasum\n    .update(`${code}-${shikiVersion}-${tsVersion}`)\n    .digest(\"hex\");\n\n  const getNmCache = () => {\n    if (__dirname.includes(\"node_modules\")) {\n      return join(\n        __dirname.split(\"node_modules\")[0],\n        \"node_modules\",\n        \".cache\",\n        \"twoslash\"\n      );\n    } else {\n      return join(__dirname, \"..\", \"..\", \".cache\", \"twoslash\");\n    }\n  };\n\n  async function getPnpCache() {\n    try {\n      // @ts-expect-error ts(2307)\n      const pnp = await import(\"pnpapi\");\n      return join(\n        pnp.getPackageInformation(pnp.topLevel).packageLocation,\n        \"node_modules\",\n        \".cache\",\n        \"twoslash\"\n      );\n    } catch (error) {\n      return getNmCache();\n    }\n  }\n\n  const cacheRoot = process.versions.pnp ? getPnpCache() : getNmCache();\n\n  const cachePath = join(await cacheRoot, `${codeSha}.json`);\n\n  if (existsSync(cachePath)) {\n    if (process.env.debug)\n      console.log(`Using cached twoslash results from ${cachePath}`);\n\n    return JSON.parse(readFileSync(cachePath, \"utf8\"));\n  } else {\n    const results = runTwoSlash(code, lang, settings);\n    if (!existsSync(await cacheRoot))\n      mkdirSync(await cacheRoot, { recursive: true });\n    writeFileSync(cachePath, JSON.stringify(results), \"utf8\");\n    return results;\n  }\n}\n","export const addIncludes = (map: Map<string, string>, name: string, code: string) => {\n  const lines: string[] = []\n\n  code.split(\"\\n\").forEach((l, _i) => {\n    const trimmed = l.trim()\n\n    if (trimmed.startsWith(\"// - \")) {\n      const key = trimmed.split(\"// - \")[1].split(\" \")[0]\n      map.set(name + \"-\" + key, lines.join(\"\\n\"))\n    } else {\n      lines.push(l)\n    }\n  })\n  map.set(name, lines.join(\"\\n\"))\n}\n\nexport const replaceIncludesInCode = (_map: Map<string, string>, code: string) => {\n  const includes = /\\/\\/ @include: (.*)$/gm\n\n  // Basically run a regex over the code replacing any // @include: thing with\n  // 'thing' from the map\n\n  // const toReplace: [index:number, length: number, str: string][] = []\n  const toReplace: [number, number, string][] = []\n\n  let match\n  while ((match = includes.exec(code)) !== null) {\n    // This is necessary to avoid infinite loops with zero-width matches\n    if (match.index === includes.lastIndex) {\n      includes.lastIndex++\n    }\n    const key = match[1]\n    const replaceWith = _map.get(key)\n\n    if (!replaceWith) {\n      const msg = `Could not find an include with the key: '${key}'.\\nThere is: ${Array.from(_map.keys())}.`\n      throw new Error(msg)\n    }\n\n    toReplace.push([match.index, match[0].length, replaceWith])\n  }\n\n  let newCode = code.toString()\n  // Go backwards through the found changes so that we can retain index position\n  toReplace.reverse().forEach(r => {\n    newCode = newCode.substring(0, r[0]) + r[2] + newCode.substring(r[0] + r[1])\n  })\n  return newCode\n}\n","import type { RemarkCodeNode } from \"./index\"\n\nimport {TwoslashError} from \"@typescript/twoslash\"\n\nfunction escapeHtml(html: string) {\n  return html.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n}\n\nexport const setupNodeForTwoslashException = (code: string, node: RemarkCodeNode, error: unknown) => {\n    const css = `<style>\n@import url('http://fonts.cdnfonts.com/css/caslon-os'); \n\n.twoslash-fixed-error-note { \n    position: fixed;\n    top: 20px;\n    right: 20px;\n    display: flex;\n    align-items: center;\n    padding: .25rem .75rem;\n    color: black;\n    background-color: #FCF3D9;\n    background-clip: padding-box;\n    border-bottom: 1px solid rgba(0,0,0,.05);\n    border-radius: .25rem;\n    font-family: -apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Arial,\"Noto Sans\",sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\",\"Segoe UI Symbol\",\"Noto Color Emoji\";\n } \n\n #__docusaurus .twoslash-fixed-error-note {\n    top: 80px;\n }\n\n .twoslash-fixed-error-note:hover {\n    border-bottom: 1px solid rgba(226, 61, 30, 0.8);\n }\n\n .twoslash-error-color {\n    background-color: #E23D1E;\n    width: 18px;\n    height: 18px;\n    border-radius: 9px;\n    margin-right:  10px;\n    color: black;\n }\n\n.twoslash-exception-message { \n    font-family: 'Caslon OS', sans-serif; \n    background-color: #FCF3D9;\n    font-size: 1.1rem;\n    padding: 2rem;\n    border-left: 2px solid #E23D1E;\n}\n\n.twoslash-exception-message p {\n    margin-top: 1rem;\n    margin-bottom: 0.6rem;\n}\n\n.twoslash-exception-message h3 { \n    margin-top: 0.6rem;\n    margin-bottom: 0.3rem;\n    font-size: 1.8rem;\n}\n\n.twoslash-exception-message code {\n     white-space: pre-wrap;\n     font-family: \"JetBrains Mono\", Menlo, Monaco, Consolas, Courier New, monospace;\n     margin-bottom: 20px;\n     background-color: #FCF3D9;\n     color: black;\n     border: none;\n     padding-left: 0;\n }\n\n .twoslash-exception-message > code {\n     display: block;\n     margin-bottom: 1.5rem;\n     margin-top: 3rem;\n }\n\n.twoslash-exception-code {\n    border-left: 2px solid #E5A604;\n    padding-left: 20px;\n    background-color: #FCF3D9;\n    color: black;\n}\n</style>`\n\n    const bodyFromTwoslashError = (error: TwoslashError) =>  {\n        return `\n<h3>${escapeHtml(error.title)}</h3>\n<p>${escapeHtml(error.description).replace(/(?:\\r\\n|\\r|\\n)/g, \"<br>\")}</p>\n<code>${escapeHtml(error.recommendation).replace(/(?:\\r\\n|\\r|\\n)/g, \"<br>\")}</code>\n`\n    }\n\n    const bodyFromError = (error: Error) => {\n        return `<pre><code>${error.message.split(\"## Code\")[0]}</code></pre>`\n    }\n\n    // @ts-ignore\n    const isWebWorker = typeof self !== \"undefined\" && typeof self.WorkerGlobalScope !== \"undefined\"\n    const isBrowser =\n      isWebWorker ||\n      (typeof window !== \"undefined\" && typeof window.document !== \"undefined\" && typeof fetch !== \"undefined\")\n  \n      const isJest = typeof jest !== \"undefined\"\n\n    const eLog = !isBrowser && !isJest ? console.error : (_str: string) => {}\n\n    let body = `<pre><code>${error}</code></pre>`\n    if (typeof error !== \"object\") {\n        body = String(error)\n        eLog(`### Unexpected error:`)\n        eLog(error)\n    } else if (error instanceof TwoslashError) {\n        body = bodyFromTwoslashError(error)\n        eLog(`### Twoslash error: ${error.title}`)\n        eLog(error.description)\n        eLog(error.recommendation)\n        eLog(\"\\n### Code Sample\")\n        eLog(code)\n    } else if (error instanceof Error) {\n        body = bodyFromError(error)\n        eLog(`### Unexpected error:`)\n        eLog(error)\n    }\n\n    const codeSample = `<p>Raising Code:</p><pre class='twoslash-exception-code'><code>${escapeHtml(code)}</code></pre>`\n\n    const html = `\n    <a href='#twoslash-error'><div class='twoslash-fixed-error-note'><span class='twoslash-error-color'></span>Twoslash failure</div></a>\n    <div class='twoslash-exception-message'>${body}${codeSample}</div>`\n\n\n    node.type = \"html\"\n    node.value =  \"<div id='twoslash-error'>\" + css + html + \"</div>\"\n    node.children = []\n}","import type { Node } from \"unist\";\nimport type { Transformer } from \"unified\";\nimport { TwoslashError, TwoSlashReturn } from \"@typescript/twoslash\";\n\nimport visit from \"unist-util-visit\";\nimport { lex, parse } from \"fenceparser\";\nimport { Lang, Highlighter, getHighlighter } from \"@olets/shiki\";\nimport { UserConfigSettings, renderCodeToHTML } from \"@olets/shiki-twoslash\";\n\nimport { cachedTwoslashCall } from \"./caching\";\nimport { addIncludes, replaceIncludesInCode } from \"./includes\";\nimport { setupNodeForTwoslashException } from \"./exceptionMessageDOM\";\n\ntype Fence = {\n  lang: string;\n  meta: NonNullable<ReturnType<typeof parse>>;\n};\n\n// A set of includes which can be pulled via a set ID\nconst includes = new Map<string, string>();\n\nfunction getHTML(\n  code: string,\n  fence: Fence,\n  highlighters: Highlighter[],\n  twoslash: TwoSlashReturn | undefined,\n  twoslashSettings: UserConfigSettings\n) {\n  // Shiki doesn't respect json5 as an input, so switch it\n  // to json, which can handle comments in the syntax highlight\n  const replacer: Record<string, string> = {\n    json5: \"json\",\n  };\n\n  if (replacer[fence.lang]) fence.lang = replacer[fence.lang];\n\n  let results;\n  // Support 'twoslash' includes\n  if (fence.lang === \"twoslash\") {\n    if (!fence.meta.include || typeof fence.meta.include !== \"string\") {\n      throw new Error(\n        \"A twoslash code block needs a pragma like 'twoslash include [name]'\"\n      );\n    }\n\n    addIncludes(includes, fence.meta.include as string, code);\n    results = twoslashSettings.wrapFragments\n      ? `<div class=\"shiki-twoslash-fragment\"></div>`\n      : \"\";\n  } else {\n    // All good, get each highlighter and render the shiki output for it\n    const output = highlighters.map((highlighter) => {\n      // @ts-ignore\n      const themeName: string = highlighter.customName\n        .split(\"/\")\n        .pop()\n        .replace(\".json\", \"\");\n      return renderCodeToHTML(\n        code,\n        fence.lang,\n        fence.meta,\n        { themeName, ...twoslashSettings },\n        highlighter,\n        twoslash\n      );\n    });\n    results = output.join(\"\\n\");\n    if (highlighters.length > 1 && twoslashSettings.wrapFragments) {\n      results = `<div class=\"shiki-twoslash-fragment\">${results}</div>`;\n    }\n  }\n  return results;\n}\n\n/**\n * Runs twoslash across an AST node, switching out the text content, and lang\n * and adding a `twoslash` property to the node.\n */\nexport async function runTwoSlashOnNode(\n  code: string,\n  { lang, meta }: Fence,\n  settings: UserConfigSettings = {}\n) {\n  // Offer a way to do high-perf iterations, this is less useful\n  // given that we cache the results of twoslash in the file-system\n  const shouldDisableTwoslash =\n    typeof process !== \"undefined\" &&\n    process.env &&\n    !!process.env.TWOSLASH_DISABLE;\n  if (shouldDisableTwoslash) return undefined;\n\n  // Only run twoslash when the meta has the attribute twoslash\n  if (meta.twoslash) {\n    const importedCode = replaceIncludesInCode(includes, code);\n    return await cachedTwoslashCall(importedCode, lang, settings);\n  }\n\n  return undefined;\n}\n\n// To make sure we only have one highlighter per theme in a process\nconst highlighterCache = new Map<UserConfigSettings, Promise<Highlighter[]>>();\n\n/** Sets up the highlighters, and cache's for recalls */\nexport const highlightersFromSettings = (settings: UserConfigSettings) => {\n  // console.log(\"i should only log once per theme\")\n  // ^ uncomment this to debug if required\n  const themes =\n    settings.themes || (settings.theme ? [settings.theme] : [\"light-plus\"]);\n\n  return Promise.all(\n    themes.map(async (theme) => {\n      // You can put a string, a path, or the JSON theme obj\n      const themeName = (theme as any).name || theme;\n      const highlighter = await getHighlighter({\n        ...settings,\n        theme,\n        themes: undefined,\n      });\n\n      // @ts-ignore - https://github.com/shikijs/shiki/pull/162 will fix this\n      highlighter.customName = themeName;\n      return highlighter;\n    })\n  );\n};\n\nconst parsingNewFile = () => includes.clear();\n\nconst parseFence = (fence: string): Fence => {\n  const [lang, ...tokens] = lex(fence);\n\n  // if the language is twoslash and include key is found\n  // insert an `=` after include to make it `include=[name]`\n  // which yields better meta\n  if (lang === \"twoslash\") {\n    // Search for `include` in tokens\n    const index = tokens.indexOf(\"include\");\n    if (index !== -1) {\n      tokens.splice(index + 1, 0, \"=\");\n    }\n  }\n\n  const meta = parse(tokens) ?? {};\n\n  return {\n    lang: (lang || \"\").toString(),\n    meta,\n  };\n};\n\n// --- The Remark API ---\n\n/* A rich AST node for uninst with twoslash'd data */\nexport type RemarkCodeNode = Node & {\n  lang?: Lang;\n  meta?: string;\n  // ^ according to mdast\n  type: string;\n  value: string;\n  children: Node[];\n  twoslash?: TwoSlashReturn;\n};\n\nexport type Options = UserConfigSettings;\n\n/**\n * Synchronous outer function, async inner function, which is how the remark\n * async API works.\n */\nfunction remarkTwoslash(settings: Options = {}) {\n  if (!highlighterCache.has(settings)) {\n    highlighterCache.set(settings, highlightersFromSettings(settings));\n  }\n\n  const transform: Transformer = async (markdownAST) => {\n    const highlighters = await highlighterCache.get(settings)!;\n    parsingNewFile();\n    visit(markdownAST, \"code\", remarkVisitor(highlighters, settings));\n  };\n\n  return transform;\n}\n\n/**\n * The function doing the work of transforming any codeblock samples in a remark AST.\n */\nexport function remarkVisitor(\n  highlighters: Highlighter[],\n  twoslashSettings: UserConfigSettings = {}\n) {\n  return async (node: RemarkCodeNode) => {\n    const code = node.value;\n    let fence: Fence = undefined!;\n\n    try {\n      fence = parseFence([node.lang, node.meta].filter(Boolean).join(\" \"));\n    } catch (error) {\n      const twoslashError = new TwoslashError(\n        \"Codefence error\",\n        \"Could not parse the codefence for this code sample\",\n        \"It's usually an unclosed string\",\n        code\n      );\n      return setupNodeForTwoslashException(code, node, twoslashError);\n    }\n\n    // Do nothing if the node has an attribute to ignore\n    if (\n      Object.keys(fence.meta).filter((key) =>\n        (twoslashSettings.ignoreCodeblocksWithCodefenceMeta || []).includes(key)\n      ).length > 0\n    ) {\n      return;\n    }\n\n    let twoslash: TwoSlashReturn | undefined;\n    try {\n      // By allowing node.twoslash to already exist you can set it up yourself in a browser\n      twoslash =\n        node.twoslash ||\n        (await runTwoSlashOnNode(code, fence, twoslashSettings));\n    } catch (error) {\n      const shouldAlwaysRaise = process && process.env && !!process.env.CI;\n      const yeahButNotInTests = typeof jest === \"undefined\";\n\n      if (\n        (shouldAlwaysRaise && yeahButNotInTests) ||\n        twoslashSettings.alwayRaiseForTwoslashExceptions\n      ) {\n        throw error;\n      } else {\n        return setupNodeForTwoslashException(code, node, error);\n      }\n    }\n\n    if (twoslash) {\n      node.value = twoslash.code;\n      node.lang = twoslash.extension as Lang;\n      node.twoslash = twoslash;\n    }\n\n    const shikiHTML = getHTML(\n      node.value,\n      fence,\n      highlighters,\n      twoslash,\n      twoslashSettings\n    );\n    node.type = \"html\";\n    node.value = shikiHTML;\n    node.children = [];\n  };\n}\n\nexport default remarkTwoslash;\n\n// --- The Markdown-it API ---\n\n/** Only the inner function exposed as a synchronous API for markdown-it */\n\nexport const setupForFile = async (settings: UserConfigSettings = {}) => {\n  parsingNewFile();\n\n  if (!highlighterCache.has(settings)) {\n    highlighterCache.set(settings, highlightersFromSettings(settings));\n  }\n\n  let highlighters = await highlighterCache.get(settings)!;\n  return { settings, highlighters };\n};\n\nexport async function transformAttributesToHTML(\n  code: string,\n  fenceString: string,\n  highlighters: Highlighter[],\n  settings: UserConfigSettings\n) {\n  const fence = parseFence(fenceString);\n\n  const twoslash = await runTwoSlashOnNode(code, fence, settings);\n  const newCode = (twoslash && twoslash.code) || code;\n  return getHTML(newCode, fence, highlighters, twoslash, settings);\n}\n"],"names":["cachedTwoslashCall","_x","_x2","_x3","_cachedTwoslashCall","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","code","lang","settings","createHash","_yield$import2","readFileSync","existsSync","mkdirSync","writeFileSync","join","shikiVersion","tsVersion","shasum","codeSha","getNmCache","getPnpCache","_getPnpCache","cacheRoot","cachePath","results","wrap","_context2","prev","next","_callee","pnp","_context","abrupt","sent","getPackageInformation","topLevel","packageLocation","t0","stop","self","WorkerGlobalScope","window","document","fetch","runTwoSlash","then","m","version","update","digest","__dirname","includes","split","process","versions","t1","t2","env","debug","console","log","JSON","parse","t3","t4","t5","t6","t7","recursive","stringify","replaceIncludesInCode","_map","match","toReplace","exec","index","lastIndex","key","replaceWith","get","msg","Array","from","keys","Error","push","length","newCode","toString","reverse","forEach","r","substring","escapeHtml","html","replace","setupNodeForTwoslashException","node","error","isBrowser","isJest","jest","eLog","_str","body","String","TwoslashError","title","description","recommendation","bodyFromTwoslashError","message","bodyFromError","type","value","children","Map","getHTML","fence","highlighters","twoslash","twoslashSettings","replacer","json5","meta","include","map","name","lines","l","_i","trimmed","trim","startsWith","set","addIncludes","wrapFragments","highlighter","themeName","customName","pop","renderCodeToHTML","_extends","runTwoSlashOnNode","_runTwoSlashOnNode","_callee5","_ref","TWOSLASH_DISABLE","_context5","undefined","importedCode","highlighterCache","highlightersFromSettings","Promise","all","themes","theme","_ref2","getHighlighter","_x4","parsingNewFile","clear","parseFence","_lex","lex","tokens","slice","indexOf","splice","_parse","remarkVisitor","_ref4","_callee3","twoslashError","shouldAlwaysRaise","yeahButNotInTests","shikiHTML","_context3","filter","Boolean","Object","ignoreCodeblocksWithCodefenceMeta","CI","alwayRaiseForTwoslashExceptions","extension","_x6","setupForFile","_ref5","_callee4","has","_context4","_x7","_transformAttributesToHTML","_callee6","fenceString","_context6","_ref3","markdownAST","visit","_x5","_x8","_x9","_x10","_x11"],"mappings":"23OAQsBA,EAAkBC,EAAAC,EAAAC,GAAA,OAAAC,EAAAC,WAAAC,WAiFvC,SAAAF,IAAA,OAAAA,EAAAG,EAAAC,IAAAC,MAjFM,SAAAC,EACLC,EACAC,EACAC,GAA4B,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EA+CbC,EAAWC,EAAAC,EAAAC,EAAAC,EAAA,OAAAtB,IAAAuB,eAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OArCO,GAqCPP,aAazB,OAbyBA,EAAApB,EAAAC,IAAAC,MAA1B,SAAA0B,IAAA,IAAAC,EAAA,OAAA5B,IAAAuB,eAAAM,GAAA,cAAAA,EAAAJ,KAAAI,EAAAH,MAAA,OAAA,OAAAG,EAAAJ,OAAAI,EAAAH,OAGsB,qCAAO,eAAS,OAAzB,OAAAG,EAAAC,gBACFlB,GADDgB,EAAGC,EAAAE,MAEHC,sBAAsBJ,EAAIK,UAAUC,gBACxC,eACA,SACA,aACD,OAAA,OAAAL,EAAAJ,OAAAI,EAAAM,GAAAN,WAAAA,EAAAC,gBAEMb,KAAY,QAAA,UAAA,OAAAY,EAAAO,UAAAT,qBAEtB9B,WAAAC,YAbcoB,aAAW,OAAAC,EAAAtB,WAAAC,cA5CR,oBAATuC,WAE2B,IAA3BA,KAAKC,mBAGO,oBAAXC,aACqB,IAApBA,OAAOC,UACG,oBAAVC,QAEEjB,EAAAE,OAAA,MAAA,OAAAF,EAAAM,gBAEJY,cAAYvC,EAAMC,EAAMC,IAAS,OAAA,OAAAmB,EAAAE,OAGb,qCAAO,eAAS,OAA3B,OAAVpB,EAAqCkB,EAAAO,KAArCzB,WAAUkB,EAAAE,QACmD,qCACnE,WACD,QAFyD,OAAlDlB,GAEPD,EAAAiB,EAAAO,MAFOvB,aAAcC,EAAUF,EAAVE,WAAYC,EAASH,EAATG,UAAWC,EAAaJ,EAAbI,cAAaa,EAAAE,QAGnC,qCAAO,aAAO,QAAzB,OAAJd,EAA6BY,EAAAO,KAA7BnB,KAAIY,EAAAE,QAEe,qCAAO,0CAAqCiB,MACrE,SAACC,GAAC,OAAKA,EAAEC,WACV,QAFiB,OAAZhC,EAAYW,EAAAO,KAAAP,EAAAE,QAGM,qCAAO,gCAA2BiB,MACxD,SAACC,GAAC,OAAKA,EAAEC,WACV,QAoCqB,OAtChB/B,EAASU,EAAAO,KAGThB,EAAST,EAAW,QACpBU,EAAUD,EACb+B,OAAU3C,MAAQU,MAAgBC,GAClCiC,OAAO,OAEJ9B,EAAa,WACjB,OAAI+B,UAAUC,SAAS,gBACdrC,EACLoC,UAAUE,MAAM,gBAAgB,GAChC,eACA,SACA,YAGKtC,EAAKoC,UAAW,KAAM,KAAM,SAAU,aAmB3C5B,EAAY+B,QAAQC,SAASxB,IAAMV,IAAgBD,IAAYO,EAAAW,GAEnDvB,EAAIY,EAAAE,QAAON,EAAS,QAAvB,GAAuBI,EAAA6B,GAAA7B,EAAAO,KAAAP,EAAA8B,GAAKtC,UAArCK,KAASG,EAAAW,IAAAX,EAAA6B,GAAA7B,EAAA8B,KAEX7C,EAAWY,IAAUG,EAAAE,QAAA,MAE0C,OAD7DyB,QAAQI,IAAIC,OACdC,QAAQC,0CAA0CrC,GAAaG,EAAAM,gBAE1D6B,KAAKC,MAAMpD,EAAaa,EAAW,UAAQ,QAGnC,OADTC,EAAUoB,cAAYvC,EAAMC,EAAMC,GAASmB,EAAAqC,GAC5CpD,EAAUe,EAAAE,QAAON,EAAS,QAAA,GAAAI,EAAAsC,GAAAtC,EAAAO,QAAAP,EAAAqC,IAAArC,EAAAsC,KAAAtC,EAAAE,QAAA,MACpB,OADoBF,EAAAuC,GAC7BrD,EAASc,EAAAE,QAAON,EAAS,QAAAI,EAAAwC,GAAAxC,EAAAO,KAAAP,EAAAyC,GAAE,CAAEC,WAAW,IAAM,EAAA1C,EAAAuC,IAAAvC,EAAAwC,GAAAxC,EAAAyC,IAAA,QACU,OAA1DtD,EAAcU,EAAWsC,KAAKQ,UAAU7C,GAAU,QAAQE,EAAAM,gBACnDR,GAAO,QAAA,UAAA,OAAAE,EAAAY,UAAAlC,QAEjBL,WAAAC,WCzFM,IAgBMsE,EAAwB,SAACC,EAA2BlE,GAU/D,IATA,IAQImE,EARErB,EAAW,yBAMXsB,EAAwC,GAGL,QAAjCD,EAAQrB,EAASuB,KAAKrE,KAAiB,CAEzCmE,EAAMG,QAAUxB,EAASyB,WAC3BzB,EAASyB,YAEX,IAAMC,EAAML,EAAM,GACZM,EAAcP,EAAKQ,IAAIF,GAE7B,IAAKC,EAAa,CAChB,IAAME,8CAAkDH,mBAAoBI,MAAMC,KAAKX,EAAKY,YAC5F,MAAM,IAAIC,MAAMJ,GAGlBP,EAAUY,KAAK,CAACb,EAAMG,MAAOH,EAAM,GAAGc,OAAQR,IAGhD,IAAIS,EAAUlF,EAAKmF,WAKnB,OAHAf,EAAUgB,UAAUC,SAAQ,SAAAC,GAC1BJ,EAAUA,EAAQK,UAAU,EAAGD,EAAE,IAAMA,EAAE,GAAKJ,EAAQK,UAAUD,EAAE,GAAKA,EAAE,OAEpEJ,GC3CT,SAASM,EAAWC,GAClB,OAAOA,EAAKC,QAAQ,KAAM,QAAQA,QAAQ,KAAM,QAGlD,IAAaC,EAAgC,SAAC3F,EAAc4F,EAAsBC,GAC9E,IA4FMC,EAD8B,oBAAT5D,WAA0D,IAA3BA,KAAKC,mBAG1C,oBAAXC,aAAqD,IAApBA,OAAOC,UAA6C,oBAAVC,MAE7EyD,EAAyB,oBAATC,KAElBC,EAAQH,GAAcC,EAAyB,SAACG,KAAjB5C,QAAQuC,MAEzCM,gBAAqBN,kBACJ,iBAAVA,GACPM,EAAOC,OAAOP,GACdI,2BACAA,EAAKJ,IACEA,aAAiBQ,iBACxBF,EA5B0B,SAACN,GAC3B,eACFL,EAAWK,EAAMS,oBAClBd,EAAWK,EAAMU,aAAab,QAAQ,kBAAmB,uBACtDF,EAAWK,EAAMW,gBAAgBd,QAAQ,kBAAmB,oBAwBrDe,CAAsBZ,GAC7BI,yBAA4BJ,EAAMS,OAClCL,EAAKJ,EAAMU,aACXN,EAAKJ,EAAMW,gBACXP,EAAK,qBACLA,EAAKjG,IACE6F,aAAiBd,QACxBoB,EA3BkB,SAACN,GACnB,oBAAqBA,EAAMa,QAAQ3D,MAAM,WAAW,mBA0B7C4D,CAAcd,GACrBI,2BACAA,EAAKJ,IAGT,IAEMJ,8LAEoCU,oEAJ2CX,EAAWxF,yBAOhG4F,EAAKgB,KAAO,OACZhB,EAAKiB,MAAS,s3DAAoCpB,EAAO,SACzDG,EAAKkB,SAAW,ICrHdhE,EAAW,IAAIiE,IAErB,SAASC,EACPhH,EACAiH,EACAC,EACAC,EACAC,GAIA,IAMIjG,EANEkG,EAAmC,CACvCC,MAAO,QAOT,GAJID,EAASJ,EAAMhH,QAAOgH,EAAMhH,KAAOoH,EAASJ,EAAMhH,OAInC,aAAfgH,EAAMhH,KAAqB,CAC7B,IAAKgH,EAAMM,KAAKC,SAAyC,iBAAvBP,EAAMM,KAAKC,QAC3C,MAAM,IAAIzC,MACR,wEFzCmB,SAAC0C,EAA0BC,EAAc1H,GAClE,IAAM2H,EAAkB,GAExB3H,EAAK+C,MAAM,MAAMsC,SAAQ,SAACuC,EAAGC,GAC3B,IAAMC,EAAUF,EAAEG,OAElB,GAAID,EAAQE,WAAW,SAAU,CAC/B,IAAMxD,EAAMsD,EAAQ/E,MAAM,SAAS,GAAGA,MAAM,KAAK,GACjD0E,EAAIQ,IAAIP,EAAO,IAAMlD,EAAKmD,EAAMlH,KAAK,YAErCkH,EAAM3C,KAAK4C,MAGfH,EAAIQ,IAAIP,EAAMC,EAAMlH,KAAK,OEgCvByH,CAAYpF,EAAUmE,EAAMM,KAAKC,QAAmBxH,GACpDmB,EAAUiG,EAAiBe,4DAEvB,QAkBJhH,EAfe+F,EAAaO,KAAI,SAACW,GAE/B,IAAMC,EAAoBD,EAAYE,WACnCvF,MAAM,KACNwF,MACA7C,QAAQ,QAAS,IACpB,OAAO8C,mBACLxI,EACAiH,EAAMhH,KACNgH,EAAMM,KAAIkB,GACRJ,UAAAA,GAAcjB,GAChBgB,EACAjB,MAGa1G,KAAK,MAClByG,EAAajC,OAAS,GAAKmC,EAAiBe,gBAC9ChH,0CAAkDA,YAGtD,OAAOA,EAOT,SAAsBuH,EAAiBpJ,EAAAC,EAAAC,GAAA,OAAAmJ,EAAAjJ,WAAAC,WAsBvC,SAAAgJ,IAFC,OAEDA,EAAA/I,EAAAC,IAAAC,MAtBO,SAAA8I,EACL5I,EAAY6I,EAEZ3I,8EAOgC,GAR9BD,EAAI4I,EAAJ5I,KAAMsH,EAAIsB,EAAJtB,cACRrH,IAAAA,EAA+B,IAKV,oBAAZ8C,UACPA,QAAQI,MACNJ,QAAQI,IAAI0F,kBACSC,EAAAxH,OAAA,MAAA,OAAAwH,EAAApH,qBAASqH,GAAS,OAAA,IAGvCzB,EAAKJ,UAAQ4B,EAAAxH,QAAA,MAC2C,OAApD0H,EAAehF,EAAsBnB,EAAU9C,GAAK+I,EAAAxH,OAC7ClC,EAAmB4J,EAAchJ,EAAMC,GAAS,OAAA,OAAA6I,EAAApH,gBAAAoH,EAAAnH,MAAA,QAAA,OAAAmH,EAAApH,qBAGxDqH,GAAS,QAAA,UAAA,OAAAD,EAAA9G,UAAA2G,QACjBlJ,WAAAC,WAGD,IAAMuJ,EAAmB,IAAInC,IAGhBoC,EAA2B,SAACjJ,GAMvC,OAAOkJ,QAAQC,KAFbnJ,EAASoJ,SAAWpJ,EAASqJ,MAAQ,CAACrJ,EAASqJ,OAAS,CAAC,gBAGlD9B,eAAG,IAAA+B,EAAA5J,EAAAC,IAAAC,MAAC,SAAA0B,EAAO+H,GAAK,IAAAlB,EAAAD,EAAA,OAAAvI,IAAAuB,eAAAM,GAAA,cAAAA,EAAAJ,KAAAI,EAAAH,MAAA,OAEyB,OAAxC8G,EAAakB,EAAc7B,MAAQ6B,EAAK7H,EAAAH,OACpBkI,iBAAchB,KACnCvI,GACHqJ,MAAAA,EACAD,YAAQN,KACR,OAGiC,OAP7BZ,EAAW1G,EAAAE,MAOL0G,WAAaD,EAAU3G,EAAAC,gBAC5ByG,GAAW,OAAA,UAAA,OAAA1G,EAAAO,UAAAT,OACnB,gBAAAkI,GAAA,OAAAF,EAAA9J,WAAAC,kBAICgK,EAAiB,WAAH,OAAS7G,EAAS8G,SAEhCC,EAAa,SAAC5C,SAClB6C,EAA0BC,MAAI9C,GAAvBhH,EAAI6J,KAAKE,EAAMF,EAAAG,SAKtB,GAAa,aAAThK,EAAqB,CAEvB,IAAMqE,EAAQ0F,EAAOE,QAAQ,YACd,IAAX5F,GACF0F,EAAOG,OAAO7F,EAAQ,EAAG,EAAG,KAIhC,IAAMiD,SAAI6C,EAAG3G,QAAMuG,IAAOI,EAAI,GAE9B,MAAO,CACLnK,MAAOA,GAAQ,IAAIkF,WACnBoC,KAAAA,aAwCY8C,EACdnD,EACAE,GAEA,gBAFAA,IAAAA,EAAuC,eAEvC,IAAAkD,EAAA1K,EAAAC,IAAAC,MAAO,SAAAyK,EAAO3E,GAAoB,IAAA5F,EAAAiH,EAAAuD,EAAArD,EAAAsD,EAAAC,EAAAC,EAAA,OAAA9K,IAAAuB,eAAAwJ,GAAA,cAAAA,EAAAtJ,KAAAsJ,EAAArJ,MAAA,OAC1BvB,EAAO4F,EAAKiB,MACdI,OAAe+B,EAAU4B,EAAAtJ,OAG3B2F,EAAQ4C,EAAW,CAACjE,EAAK3F,KAAM2F,EAAK2B,MAAMsD,OAAOC,SAASrK,KAAK,MAAMmK,EAAArJ,QAAA,MAAA,OAOpE,OAPoEqJ,EAAAtJ,OAAAsJ,EAAA5I,GAAA4I,WAE/DJ,EAAgB,IAAInE,gBACxB,kBACA,qDACA,kCACArG,GACD4K,EAAAjJ,gBACMgE,EAA8B3F,EAAM4F,EAAM4E,IAAc,QAAA,KAK/DO,OAAOjG,KAAKmC,EAAMM,MAAMsD,QAAO,SAACrG,GAAG,OAChC4C,EAAiB4D,mCAAqC,IAAIlI,SAAS0B,MACpES,OAAS,IAAC2F,EAAArJ,QAAA,MAAA,OAAAqJ,EAAAjJ,iBAAA,QASG,GATHiJ,EAAAtJ,QAAAsJ,EAAA1H,GASV0C,EAAKuB,SAAQyD,EAAA1H,IAAA0H,EAAArJ,QAAA,MAAA,OAAAqJ,EAAArJ,QACNmH,EAAkB1I,EAAMiH,EAAOG,GAAiB,QAAAwD,EAAA1H,GAAA0H,EAAAhJ,KAAA,QAFzDuF,EAAQyD,EAAA1H,GAAA0H,EAAArJ,QAAA,MAAA,QAK6C,GAL7CqJ,EAAAtJ,QAAAsJ,EAAAzH,GAAAyH,YAIFH,EAAoBzH,SAAWA,QAAQI,OAASJ,QAAQI,IAAI6H,GAC5DP,EAAoC,oBAAT1E,OAG9ByE,GAAqBC,GACtBtD,EAAiB8D,kCAA+BN,EAAArJ,QAAA,MAAA,MAAAqJ,EAAAzH,GAAA,QAAA,OAAAyH,EAAAjJ,gBAIzCgE,EAA8B3F,EAAM4F,EAAIgF,EAAAzH,KAAQ,QAIvDgE,IACFvB,EAAKiB,MAAQM,EAASnH,KACtB4F,EAAK3F,KAAOkH,EAASgE,UACrBvF,EAAKuB,SAAWA,GAGZwD,EAAY3D,EAChBpB,EAAKiB,MACLI,EACAC,EACAC,EACAC,GAEFxB,EAAKgB,KAAO,OACZhB,EAAKiB,MAAQ8D,EACb/E,EAAKkB,SAAW,GAAG,QAAA,UAAA,OAAA8D,EAAA3I,UAAAsI,4BACpB,gBAAAa,GAAA,OAAAd,EAAA5K,WAAAC,eASH,IAAa0L,aAAY,IAAAC,EAAA1L,EAAAC,IAAAC,MAAG,SAAAyL,EAAOrL,oEAKhC,gBALgCA,IAAAA,EAA+B,IAChEyJ,IAEKT,EAAiBsC,IAAItL,IACxBgJ,EAAiBjB,IAAI/H,EAAUiJ,EAAyBjJ,IACzDuL,EAAAlK,OAEwB2H,EAAiBxE,IAAIxE,GAAU,OAAxC,OAAAuL,EAAA9J,gBACT,CAAEzB,SAAAA,EAAUgH,aADHuE,EAAA7J,OACiB,OAAA,UAAA,OAAA6J,EAAAxJ,UAAAsJ,OAClC,gBATwBG,GAAA,OAAAJ,EAAA5L,WAAAC,eAsBxB,SAAAgM,IAAA,OAAAA,EAAA/L,EAAAC,IAAAC,MAXM,SAAA8L,EACL5L,EACA6L,EACA3E,EACAhH,GAA4B,IAAA+G,EAAAE,EAAA,OAAAtH,IAAAuB,eAAA0K,GAAA,cAAAA,EAAAxK,KAAAwK,EAAAvK,MAAA,OAES,OAA/B0F,EAAQ4C,EAAWgC,GAAYC,EAAAvK,OAEdmH,EAAkB1I,EAAMiH,EAAO/G,GAAS,OACZ,OAAA4L,EAAAnK,gBAC5CqF,GAFDG,EAAQ2E,EAAAlK,OACeuF,EAASnH,MAASA,EACvBiH,EAAOC,EAAcC,EAAUjH,IAAS,OAAA,UAAA,OAAA4L,EAAA7J,UAAA2J,QACjElM,WAAAC,2BAjHD,SAAwBO,GAWtB,gBAXsBA,IAAAA,EAAoB,IACrCgJ,EAAiBsC,IAAItL,IACxBgJ,EAAiBjB,IAAI/H,EAAUiJ,EAAyBjJ,eAG3C,IAAA6L,EAAAnM,EAAAC,IAAAC,MAAgB,SAAAC,EAAOiM,GAAW,IAAA9E,EAAA,OAAArH,IAAAuB,eAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OAAA,OAAAF,EAAAE,OACpB2H,EAAiBxE,IAAIxE,GAAU,OAApDgH,EAAY7F,EAAAO,KAClB+H,IACAsC,EAAMD,EAAa,OAAQ3B,EAAcnD,EAAchH,IAAW,OAAA,UAAA,OAAAmB,EAAAY,UAAAlC,OACnE,gBAJcmM,GAAA,OAAAH,EAAArM,WAAAC,gKAiGjB,SAA+CwM,EAAAC,EAAAC,EAAAC,GAAA,OAAAX,EAAAjM,WAAAC"}